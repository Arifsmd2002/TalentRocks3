<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Active Project | Talentrox</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" />
</head>

<body>
    <div class="app-layout">
        <div th:replace="~{fragments/freelancer-sidebar :: freelancer-sidebar}"></div>

        <main class="main-content">
            <div class="page-header">
                <a href="/freelancer/dashboard" class="text-muted text-sm"
                    style="display:inline-flex;align-items:center;gap:4px;margin-bottom:8px;">‚Üê Back to Dashboard</a>
                <h1 class="page-title" th:text="${project.title}">Project</h1>
                <span class="project-badge badge-progress" style="margin-top:4px;">‚öôÔ∏è In Progress</span>
            </div>

            <div th:if="${success}" class="alert alert-success">‚úÖ <span th:text="${success}"></span></div>

            <!-- Milestone Tracker -->
            <div class="card">
                <div class="card-header">üéØ Milestone Tracker</div>
                <div class="card-body">
                    <div th:if="${milestones == null or milestones.isEmpty()}"
                        style="text-align:center; padding:2rem; color:var(--text-muted);">
                        <div style="font-size:3rem; margin-bottom:0.5rem;">‚è≥</div>
                        <p>No milestones added yet. The client will add them soon.</p>
                    </div>

                    <div th:each="milestone, iter : ${milestones}"
                        style="border:1px solid var(--bg-border); border-radius:12px; padding:1.5rem; margin-bottom:1rem; transition:var(--transition);">
                        <div class="flex-between mb-3">
                            <div class="flex items-center gap-3">
                                <div style="width:36px; height:36px; border-radius:50%; background:linear-gradient(135deg,var(--primary),var(--secondary)); display:flex;align-items:center;justify-content:center; font-weight:700; font-size:0.85rem; flex-shrink:0;"
                                    th:text="${iter.index + 1}">1</div>
                                <div>
                                    <div style="font-weight:600; font-size:1rem;" th:text="${milestone.title}">Milestone
                                    </div>
                                    <div class="text-muted text-xs"
                                        th:text="${milestone.dueDate != null ? 'Due: ' + #temporals.format(milestone.dueDate, 'dd MMM yyyy') : 'No deadline set'}">
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <span th:if="${milestone.amount != null}"
                                    style="font-weight:700; color:var(--secondary);">‚Çπ<span
                                        th:text="${#numbers.formatDecimal(milestone.amount, 1, 0)}">0</span></span>
                                <span th:switch="${milestone.status.name()}">
                                    <span th:case="'PENDING'" class="project-badge badge-pending">‚è≥ Pending</span>
                                    <span th:case="'IN_PROGRESS'" class="project-badge badge-progress">üîµ Working</span>
                                    <span th:case="'SUBMITTED'" class="project-badge"
                                        style="background:rgba(252,211,77,0.15);color:var(--warning);">üì® Under
                                        Review</span>
                                    <span th:case="'APPROVED'" class="project-badge badge-completed">‚úÖ Approved &
                                        Paid</span>
                                    <span th:case="'REJECTED'" class="project-badge badge-cancelled">‚ùå Rejected</span>
                                </span>
                            </div>
                        </div>

                        <p class="text-secondary-color text-sm mb-2" th:if="${milestone.description}"
                            th:text="${milestone.description}"></p>

                        <div th:if="${milestone.clientFeedback}" class="alert alert-error" style="font-size:0.85rem;">
                            üí¨ Client Feedback: <span th:text="${milestone.clientFeedback}"></span>
                        </div>

                        <!-- Submit button for PENDING or REJECTED milestones -->
                        <div
                            th:if="${milestone.status.name() == 'PENDING' or milestone.status.name() == 'IN_PROGRESS' or milestone.status.name() == 'REJECTED'}">
                            <form th:action="@{/freelancer/milestone/{id}/submit(id=${milestone.id})}" method="post">
                                <button type="submit" class="btn btn-primary btn-sm">üì® Submit for Review</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</body>

</html>