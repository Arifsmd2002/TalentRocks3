<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Messages | Admin â€” Talentrock</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" />
</head>

<body>
    <div class="app-layout">
        <!-- Admin Sidebar -->
        <div class="sidebar">
            <a href="/" class="sidebar-brand">
                <div class="logo-icon">âš¡</div> Talentrock
            </a>
            <div class="sidebar-section">
                <div class="sidebar-label">Admin Panel</div>
                <a href="/admin/dashboard" class="sidebar-link"><span class="icon">ğŸ“Š</span> Dashboard</a>
                <a href="/admin/users" class="sidebar-link"><span class="icon">ğŸ‘¥</span> Manage Users</a>
                <a href="/admin/projects" class="sidebar-link"><span class="icon">ğŸ“‹</span> All Projects</a>
                <a href="/admin/subscriptions" class="sidebar-link"><span class="icon">ğŸ’³</span> Subscriptions</a>
                <a href="/admin/messages" class="sidebar-link active" style="position:relative;">
                    <span class="icon">ğŸ“¬</span> Messages
                    <span th:if="${unreadMessages != null and unreadMessages > 0}" th:text="${unreadMessages}"
                        style="position:absolute;right:12px;top:50%;transform:translateY(-50%);background:#ef4444;color:#fff;border-radius:999px;font-size:0.68rem;font-weight:700;padding:0.1rem 0.45rem;"></span>
                </a>
            </div>
            <div class="sidebar-footer">
                <div class="flex items-center gap-2" style="margin-bottom:12px;">
                    <div class="avatar"
                        th:text="${user.fullName != null ? user.fullName.substring(0,1).toUpperCase() : 'A'}">A</div>
                    <div>
                        <div style="font-size:0.9rem;font-weight:600;"
                            th:text="${user.fullName != null ? user.fullName : user.username}">Admin</div>
                        <div class="text-muted text-xs" style="color:var(--error);">ğŸ›¡ï¸ Administrator</div>
                    </div>
                </div>
                <a href="/logout" class="btn btn-ghost btn-sm" style="width:100%;justify-content:center;">Sign Out</a>
            </div>
        </div>

        <main class="main-content">
            <div class="page-header">
                <h1 class="page-title">ğŸ“¬ Contact <span class="gradient-text">Messages</span></h1>
                <p class="page-subtitle"
                    th:text="${unreadMessages > 0 ? unreadMessages + ' unread message(s)' : 'All messages read'}"></p>
            </div>

            <div class="card">
                <div th:if="${messages == null or messages.isEmpty()}"
                    style="padding:3rem;text-align:center;color:var(--text-muted);">
                    <div style="font-size:3rem;margin-bottom:1rem;">ğŸ“­</div>
                    <div>No contact messages yet.</div>
                </div>

                <div th:each="msg : ${messages}"
                    th:style="${!msg.isRead ? 'border-left:3px solid #6366f1;' : 'border-left:3px solid transparent;'}"
                    style="padding:1.25rem 1.5rem;border-bottom:1px solid rgba(255,255,255,0.06);transition:background 0.15s;">

                    <div
                        style="display:flex;align-items:flex-start;justify-content:space-between;gap:1rem;flex-wrap:wrap;">
                        <div style="flex:1;">
                            <div style="display:flex;align-items:center;gap:0.6rem;margin-bottom:0.3rem;">
                                <span th:if="${!msg.isRead}"
                                    style="width:8px;height:8px;background:#6366f1;border-radius:50%;flex-shrink:0;"></span>
                                <span style="font-weight:700;font-size:0.95rem;" th:text="${msg.senderName}">Name</span>
                                <span style="font-size:0.8rem;color:rgba(255,255,255,0.4);"
                                    th:text="${msg.senderEmail}">email</span>
                                <span th:if="${!msg.isRead}"
                                    style="background:rgba(99,102,241,0.15);color:#818cf8;border:1px solid rgba(99,102,241,0.25);padding:0.12rem 0.55rem;border-radius:999px;font-size:0.7rem;font-weight:700;">NEW</span>
                            </div>
                            <div style="color:rgba(255,255,255,0.7);font-size:0.88rem;line-height:1.6;margin-bottom:0.5rem;"
                                th:text="${msg.message}">Message</div>
                            <div style="font-size:0.77rem;color:rgba(255,255,255,0.3);"
                                th:text="${#temporals.format(msg.createdAt, 'dd MMM yyyy, hh:mm a')}">Date</div>
                        </div>

                        <div th:if="${!msg.isRead}">
                            <form th:action="@{/admin/messages/{id}/read(id=${msg.id})}" method="post">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                <button type="submit"
                                    style="padding:0.45rem 0.9rem;border-radius:8px;background:rgba(99,102,241,0.1);border:1px solid rgba(99,102,241,0.25);color:#818cf8;font-size:0.8rem;font-weight:600;cursor:pointer;transition:all 0.2s;">
                                    âœ“ Mark Read
                                </button>
                            </form>
                        </div>
                        <div th:if="${msg.isRead}"
                            style="font-size:0.8rem;color:rgba(255,255,255,0.25);white-space:nowrap;">âœ“ Read</div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</body>

</html>